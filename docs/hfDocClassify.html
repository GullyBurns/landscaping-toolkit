---

title: HuggingFace Document Classification Utils 


keywords: fastai
sidebar: home_sidebar

summary: "Classes to build and run document classification pipelines using baseline HuggingFace functionality."
description: "Classes to build and run document classification pipelines using baseline HuggingFace functionality."
nb_path: "10_hfDocClassify.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 10_hfDocClassify.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Running on transformers v4.18.0 and datasets v2.4.0
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/home/runner/work/czLandscapingTk/czLandscapingTk/czLandscapingTk/docClassify.py:199: FutureWarning: MLflow support for Python 3.6 is deprecated and will be dropped in an upcoming release. At that point, existing Python 3.6 workflows that use MLflow will continue to work without modification, but Python 3.6 users will no longer get access to the latest MLflow features and bugfixes. We recommend that you upgrade to Python 3.7 or newer.
  import mlflow
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This library contains a single utility class and several functions to make it easy to run a simple document classifier for scientific papers.</p>
<p>An example code run through is as follows:</p>
<p>```</p>
<h1 id="DRSM-BASIC-TRAINING-ANALYSIS">DRSM BASIC TRAINING ANALYSIS<a class="anchor-link" href="#DRSM-BASIC-TRAINING-ANALYSIS"> </a></h1><p>import datasets</p>
<p>column_names =['ID_PAPER', 'Labeling_State', 'Comments', 'Explanation', 'Correct_Label', 'Agreement', 'TRIMMED_TEXT']
text_columns = ['TRIMMED_TEXT']
label_column = 'Correct_Label'
drsm_categories = ['clinical characteristics or disease pathology',
              'therapeutics in the clinic', 
              'disease mechanism', 
              'patient-based therapeutics', 
              'other',
              'irrelevant']</p>
<p>ds_temp = datasets.load_dataset('csv', delimiter="\t", data_files='/dbfs/FileStore/user/gully/drsm_curated_data/labeled_data_2022_01_03.tsv')
train_test_valid = ds_temp['train'].train_test_split(0.1)
test_valid = train_test_valid['test'].train_test_split(0.5)
drsm_ds = datasets.DatasetDict({
    'train': train_test_valid['train'],
    'test': test_valid['test'],
    'valid': test_valid['train']})</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Running on transformers v4.18.0 and datasets v2.4.0
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="HF_trainer_wrapper" class="doc_header"><code>class</code> <code>HF_trainer_wrapper</code><a href="https://github.com/GullyBurns/czLandscapingTk/tree/master/czLandscapingTk/docClassify.py#L31" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>HF_trainer_wrapper</code>(<strong><code>run_name</code></strong>, <strong><code>model_ckpt</code></strong>, <strong><code>output_dir</code></strong>, <strong><code>logging_dir</code></strong>, <strong><code>epochs</code></strong>, <strong><code>max_length</code></strong>=<em><code>512</code></em>, <strong><code>problem_type</code></strong>=<em><code>'multi_label_classification'</code></em>)</p>
</blockquote>
<p>Class to provide support training and experimenting with simple document classification tools under either a multi-label or multi-class classification paradigm.</p>
<p>Attributes:</p>
<ul>
<li>run_name:</li>
<li>model_ckpt:</li>
<li>output_dir:</li>
<li>logging_dir:</li>
<li>epochs:</li>
<li>max_length:</li>
<li>problem_type:</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="run_HF_trainer_expt" class="doc_header"><code>run_HF_trainer_expt</code><a href="https://github.com/GullyBurns/czLandscapingTk/tree/master/czLandscapingTk/docClassify.py#L202" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>run_HF_trainer_expt</code>(<strong><code>ds</code></strong>, <strong><code>text_columns</code></strong>, <strong><code>label_column</code></strong>, <strong><code>categories</code></strong>, <strong><code>run_name</code></strong>, <strong><code>model_input</code></strong>, <strong><code>model_path</code></strong>, <strong><code>log_path</code></strong>, <strong><code>epochs</code></strong>, <strong><code>batch_size</code></strong>=<em><code>8</code></em>, <strong><code>transfer_model</code></strong>=<em><code>None</code></em>, <strong><code>problem_type</code></strong>=<em><code>'multi_label_classification'</code></em>, <strong><code>run_training</code></strong>=<em><code>True</code></em>, <strong><code>freeze_layers</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_folds_from_dataframe" class="doc_header"><code>get_folds_from_dataframe</code><a href="https://github.com/GullyBurns/czLandscapingTk/tree/master/czLandscapingTk/docClassify.py#L248" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_folds_from_dataframe</code>(<strong><code>df</code></strong>, <strong><code>id_col</code></strong>, <strong><code>category_col</code></strong>, <strong><code>n_splits</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="run_HF_trainer_kfold_crossvalidation" class="doc_header"><code>run_HF_trainer_kfold_crossvalidation</code><a href="https://github.com/GullyBurns/czLandscapingTk/tree/master/czLandscapingTk/docClassify.py#L277" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>run_HF_trainer_kfold_crossvalidation</code>(<strong><code>folds</code></strong>, <strong><code>text_columns</code></strong>, <strong><code>label_column</code></strong>, <strong><code>categories</code></strong>, <strong><code>run_name</code></strong>, <strong><code>model_input</code></strong>, <strong><code>model_path</code></strong>, <strong><code>log_path</code></strong>, <strong><code>epochs</code></strong>, <strong><code>batch_size</code></strong>=<em><code>8</code></em>, <strong><code>problem_type</code></strong>=<em><code>'multi_label_classification'</code></em>, <strong><code>transfer_model</code></strong>=<em><code>None</code></em>, <strong><code>run_training</code></strong>=<em><code>True</code></em>, <strong><code>freeze_layers</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

